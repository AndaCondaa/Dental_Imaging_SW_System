<h1/> HL7 분석

<h2/> 1. 기본 개념

<h3/> 1.1 대상

- 메시지 구조 : 메시지의 추상적 정의

- Encoding rules :  전송을 위한 메시지의 표현

- 트리거 이벤트 : 메시지를 촉발하는 어플리케이션 이벤트로써 실계계에서의 이벤트는 두 시스템간 정보의 교환을 촉발시킴

  <br/>

  <br/>

<h3/> 1.2 HL7의 기본원리

<h5/> 1.2.1 트리거 이벤트와 시스템간 메시지 전송

- 트리거 이벤트에 의해 하나의 사건이 촉발 -> 데이터의 교환이 일어나게 될 두 개 이상의 시스템이 네트워크를 통해 경로 설정
- 하나의 시스템(시스템A)에서 다른 하나의 시스템(시스템B)으로 메시지의 형태로 데이터의 전송이 이루어짐
- 메시지를 수신한 시스템 B에서는 수신 여부를 확인하여 주는 메시지를 다시 시스템 A로 보냄으로서 하나의 사이클이 마무리됨
- 위 사이클에서 발생하는 트리거 이벤트, 메시지 구조, 메시지 표현 규칙 등이 HL7표준을 통해 이루어짐

<br/>

<h5/> 1.2.2 이벤트와 자동갱신

- '환자입원'과 같은 트리거 이벤트는 새로운 환자 정보를 병원 데이터베이스에 추가하기 위해 메시지를 송신하는 시스템에서 하나의 내부 트랜잭션을 일으키게 됨
- 이 때 HL7을 통해 데이터가 전송되고 수신 시스템에서 메시지를 수신하게 되면 트랜잭션에 의해 스스로 반응하여 프로세스를 수행하게 되는데 이를 자동갱신이라 함

<br/>

<h5/> 1.2.3 이벤트와 수신확인 (Acknowledgment) 메시지

- HL7 메시지의 송수신 메카니즘은 송신측 시스템이 수신측 시스템으로부터 수신확인 메시지를 받음으로써 완전한 사이클이 이루어 짐

<br/>

<br/>

<h2/> 2. 내용 및 구조

<h3/> 2.1 HL7 메시지의 범위

- 아래와 같이 HL7은 의료서비스 제공기관에서 이루어지는 다양한 업무 관련 메시지를 정의하고 있음
  - ADT (환자 관리 : 입원, 퇴원, 전원)
  - Queries (조회)
  - Order Entry (일반 처방, 약 처방, 공급 처방, 식이요법 처방, 백신 관리)
  - Observations reporting (처방 및 임상 결과에 대한 관찰기록 보고)
  - Product experiences (제품 실험)
  - Waveform results (파형 결과)
  - Patient referral (환자 의뢰)
  - Financial management (회계 관리)
  - Master files (마스터 파일)
  - Patient care (환자 진료)
  - Scheduling (일정 관리)
  - Notice about drug interactions (약물 효능 및 부작용 고지)
  - Medical records / information management (의무 기록 / 정보 관리)

<br/>

<h3/> 2.2 HL7의 구조

<h5/> 2.2.1 메시지

- Message는 데이터 전송의 가장 작은 단위이며, Segment들로 구성
  - 메시지는 메시지 헤더 세그먼트(MSH)로 시작
  - 메시지 타입과 트리거 이벤트의 조합으로 메시지를 구별
  - "Z"로 시작하는 모든 메시지 타입과 트리거 이벤트 코드는 각 지역의 특수성에 맞도록 사용자 정의 메시지로 사용됨
- 예시 : 환자의 입원 정보를 전송하는 메시지의 경우, 메시지 타입 ADT와 트리거 이벤트 A01의 조합 ADT^A01으로 확인할 수 있음

<h5/> 2.2.2 세그먼트 (Segments)

- 세그먼트는 정해진 순서가 있는 필드들의 논리적 집합
  - 필수 세그먼트, 선택적 세그먼트가 있음
  - 모든 세그먼트에는 주어진 이름이 존재
  - 세그먼트는 세그먼트 ID라고 하는 처음 세글자에 의해 식별 가능함
  - 세그먼트는 세그먼트 구분자(Segment separators : \<CR>)에 의해 나누어짐
  - "Z"로 시작하는 모든 세그먼트 ID 코드는 사용자 정의 세그먼트로 사용
- 세그먼트 구성 예(ADT 메시지)
  - MSH : 메시지 헤더
  - EVN : 트리거 이벤트 유형
  - PID : 환자 ID
  - PV1 : 환자 방문 정보

<h5/> 2.2.3 필드 (Fields)

- 메시지의 실제 내용은 세그먼트의 필드에서 표현됨
- 필드는 컴포넌트들의 집합이며, 컴포넌트는 다시 서브컴포넌트로 구성됨
- 필드의 특성
  - 필드의 길이는 다양하며, 필드 구분자에 의해 구별됨
  - 각 필드는 String, Text, Numeric, Date, Time 등 자료형으로 정의됨
  - 필드가 전송될 때는, 문자열의 형태로 전송됨
  - Null 값은 ""로 보낼 수 있음. 이는 선택필드에서 값을 제외하는 것과 구별됨

<br/>

<h3/> 2.3 메시지 구분자(Message Delimiters)

- 메시지를 구성할 때 사용되는 특수문자로서, 세그먼트 구분자, 필드 구분자, 컴포넌트 구분자, 서브컴포넌트 구분자, 그리고 Escape 문자가 있음


<br/>

<h3/> 2.4 추상 메시지 구문(Abstract Message Syntax)

- 개념 및 규칙
  - 하나의 메시지는 컨트롤과 데이터 세그먼트들로 구성되는데, 이들 세그먼트들의 발생 빈도에 대한 정의는 추상 메시지 구문으로 나타낼 수 있음
  - 필수 세그먼트는 세그먼트 ID로, 선택 세그먼트는 [...]으로, 반복 세그먼트는 {...}로 표시함
  - 추상 메시지의 작성 규칙의 세 단계
    - 모든 메시지는 메시지 자체에 대한 정보로부터 시작됨. 예컨대, 메시지 헤더를 나타내는 MSH, 이벤트에 대해 기술한 EVN 등을 말함
    - 그 뒤로, 환자 관려 정보들이 나타남. 예컨대, 환자 ID의 PID, 환자방문정보의 PV1과 PV2, 알러지 정보인 AL1 등을 말
    - 다시 그 뒤를 추가 정보가 따라 붙는 형태를 취함. 예컨대, 검사결과, 성능, 견적서 등
- 추상 메시지 구문의 예
  - 